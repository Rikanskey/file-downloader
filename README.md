# File Downloader

## Суть проекта
Веб-сервис в который пользователь может отправлять задачи со списком ссылок на файлы из интернета, которые ему нужно скачать. А сервис будет их скачивать и складывать в папку. По созданной задаче можно получать ее статус.

## Выполнение задачи
Приложение разделено на две части:
1. Сетевую, принимающей и обрабатывающей входящие HTTP-запросы;
2. Загрузочную, которая отвечает за загрузку файлов по ссылкам, поступающих через сетевую часть.

Каждая из этих частей работает в контексте своего основного потока. Такой подход минимизирует вероятность потери запроса пользователя и гарантирует, что его запрос обязательно будет обработан.

Также у каждой части есть собственное хранилище данных, представленное в виде файла формата .csv. Файл сервера хранит только приходящие запросы на создание задачи на скачивание, представляющие собой сгенерированный ID-задачи и список ссылок на файлы.
Файл загрузочной части, помимо ID и cсылки, хранит ещё и статус задачи: выполнение, ожидание, или же статус ошибки, если ссылка оказалась некорректной.
Чтобы избежать ошибок при записи в файл, сетевая часть приложения имеет права на запись только для своего файла, в то время как с файла загрузок может только считывать. Например, если пользователь захочет отправить GET-запрос по ID своих задач. 
Тот же принцип и для загрузочной части: файл с сетевыми запросами используется только чтобы пополнить собственный файл актуальными задачами. 

Внутри самой программы, чтобы несколько горутин не предпринимали попыток одновременной записи в файл, на время записи доступ блокируется мьютексом.

### Восстановление в случае сбоя программы
Статус задачи меняется после попытки скачать его. Если работа программы будет прервана, то статус останется неизменным. 
В случае перезагрузки/остановки программы, загрузочная часть сначала проверяет файл сетевой части на наличие новых актуальных задач и добавляет их в собственный файл.
Далее проходит по собственному файлу, проверяя его на наличие запросов в статусе ожидания для последующей загрузки. После этого, приложение входит в обычный режим работы с периодической проверкой сетевого файла и работа с новыми запросами оттуда.

Если же остановится сетевая часть, то пользователь получит в качестве ответа уведомление об ошибке на стороне сервера вместо ID своего запроса. В таком случае, запрос придётся отправить повторно.

